{% extends "moon/base_site.html" %}

{% block tcontent %}Intra Extension administration page
{% endblock %}
{% block pmenu %}
    {{ block.super }}
    {% if graph %}
        <img src="/static/{{ graph }}" width="300"/>
    {% endif %}
{% endblock %}
{% block pcontent %}
    {% if extension %}
        <b>uuid:</b> {{ extension.uuid }}<br/>
        <b>name:</b> {{ extension.name }}<br/>
        <b>description:</b> {{ extension.description  }}<br/>
        <b>tenant:</b> {{ extension.tenant.name }} ({{ extension.tenant.uuid }})<br/>
        <b>subjects:</b> <ul>
        {% for subject in extension.subjects %}
            <li>{{ subject.name }}</li>
        {% endfor %}
        </ul>
        <b>objects:</b> <ul>
        {% for object in extension.objects %}
            <li>{{ object.name }}</li>
        {% endfor %}
        </ul>
        <b>metadata:</b> <ul>
        {% for data in extension.metadata %}
            <li>{{ data }}</li>
        {% endfor %}
        </ul>
        <b>rules:</b>
        <table border="1">
        <tr>
            <th>Name</th>
            <th colspan="3">Attribute rules</th>
            <th>description</th>
        </tr>
        {% for rule in extension.rules %}
            {% cycle 'row1' 'row2' as divcolors%}
            {% for orule in rule.s_attr %}
            <tr class={{ divcolors }}>
                {% if forloop.first %}
                <td rowspan="{{ rule|rule_length }}">{{ rule.name }}</td>
                {% endif %}
                <td>Subject:</td><td>{{ orule.category }}</td><td>{{ orule.value }}</td>
                {% if forloop.first %}
                <td rowspan="{{ rule|rule_length }}">{{ rule.description }}</td>
                {% endif %}
            </tr>
            {% endfor %}
            {% for orule in rule.o_attr %}
            <tr class={{ divcolors }}>
                <td>Object:</td><td>{{ orule.category }}</td><td>{{ orule.value }}</td>
            </tr>
            {% endfor %}
        {% endfor %}
        </table>
    {% elif extensions %}
        <div id="intra_extensions_list">
            <table border="1">
                <tr>
                    <th>UUID</th>
                    <th>Description</th>
                </tr>
                {% for ext in extensions %}
                <tr>
                    <td>
                        <a href="/intra-extensions/{{ ext.uuid }}/">{{ ext.uuid }}</a>
                    </td>
                    <td>
                        {{ ext.html }}
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    {% endif %}
{% endblock %}